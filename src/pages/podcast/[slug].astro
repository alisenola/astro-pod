---
import { CollectionEntry, getCollection } from "astro:content";
import { podcastSchema } from "../../content/config";
import PodcastLayout from "../../layouts/PodcastLayout.astro";
import AudioPlayer from "../../components/audioPlayer.astro";

export async function getStaticPaths() {
  const postEntries = await getCollection("podcast");
  return postEntries.map((entry) => ({
    params: { slug: entry.slug },
    props: { entry },
  }));
}

interface Props {
  entry: CollectionEntry<"podcast">;
}

const { entry } = Astro.props;
const podcast: podcastSchema = entry.data;
const { Content } = await entry.render();
---

<PodcastLayout
  title={podcast.title}
  description={podcast.description}
  pubDate={podcast.pubDate}
  updatedDate={podcast.updatedDate}
>
  <Content />
</PodcastLayout>

<AudioPlayer />

<script define:vars={{ podcast }}>
const musicPlayer = document.getElementById("audio-player-container");
const audioDownloadLink = document.getElementById("audio-download-link");

musicPlayer?.classList.remove("hidden", "opacity-0");
musicPlayer?.classList.add("flex");
const audio = document.querySelector("audio");
audio.src = podcast.audioUrl;
audioDownloadLink.href = podcast.audioUrl;
</script>
